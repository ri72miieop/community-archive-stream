# Community Archive Native App

This is the native messaging host for the Community Archive Stream browser extension. It's written in TypeScript and runs with Bun.

## Setup

1. **Install Bun** (if not already installed):
   ```bash
   curl -fsSL https://bun.sh/install | bash
   ```

2. **Run the setup script for your OS**:

   **Windows:**
   ```bash
   cd extras/localStreamNativeApp
   setup.bat
   ```
   This will:
   - Generate `install_generated.reg` with correct paths for your system
   - Update `native_app_native_msg_host_manifest.json` with correct paths (properly escaped)
   - Show instructions for completing registration

   **macOS/Linux:**
   ```bash
   cd extras/localStreamNativeApp
   chmod +x setup.sh run_native.sh
   ./setup.sh
   ```
   This will:
   - Create `native_app_native_msg_host_manifest.json` with Unix paths (no escaping needed)
   - Automatically install to browser directories

3. **Complete browser registration (Windows only)**:
   - Double-click `install_generated.reg` and approve the registry changes
   - Or run: `regedit install_generated.reg`
   - (macOS/Linux: setup.sh handles this automatically)

## Files

- `native_app.ts` - Main TypeScript native app
- `native_app_native_msg_host_manifest.json` - Native messaging host manifest (generated by setup)
- `run_native.bat` - Windows batch file to run the Bun script  
- `run_native.sh` - macOS/Linux shell script to run the Bun script
- `setup.bat` - Windows setup script (handles registry + path escaping)
- `setup.sh` - macOS/Linux setup script (handles directory installation)
- `install.reg` / `remove.reg` - Static registry files (use setup scripts instead)
- `test_native.ts` - Test script
- `package.json` - Bun project configuration
- `data/` - Directory where `tweets.db` SQLite database is stored

## Usage

### Development
```bash
bun run dev          # Run with auto-reload
bun run test         # Run tests
```

### Production
The browser extension will automatically start this via the batch file when needed.

## Database

- SQLite database (`tweets.db`) is created in a `data/` subdirectory for better organization
- Schema matches the IndexDB structure from the main extension
- No more scattered temp files like with PyInstaller - database stays exactly where you expect it

## Advantages over Python + PyInstaller

- ✅ No compilation needed
- ✅ Database stays in project directory (organized in `data/` folder)
- ✅ Faster startup time  
- ✅ Better development experience
- ✅ TypeScript type safety
- ✅ Smaller memory footprint
- ✅ Easy to modify and debug
- ✅ Proper path escaping for all Windows configurations

